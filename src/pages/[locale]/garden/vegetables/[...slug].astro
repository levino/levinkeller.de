---
import { getCollection } from 'astro:content'
import { MONTHS_DE, MONTHS_EN } from '@levino/shipyard-base'
import Layout from '@levino/shipyard-base/layouts/Page.astro'
import type { GetStaticPaths } from 'astro'

export const getStaticPaths = (async () => {
  const vegs = await getCollection('vegetables')
  return vegs.map((entry) => ({
    params: { slug: entry.id, locale: 'de' },
    props: { entry },
  }))
}) satisfies GetStaticPaths

const { entry: veg } = Astro.props
const canonicalUrl = `${Astro.site}de/garden/vegetables/${veg.id}/`
const timingLabel = (timing?: string) => {
  if (!timing) return ''
  const labels: Record<string, string> = {
    early: 'Anfang',
    mid: 'Mitte',
    late: 'Ende',
    'early-mid': 'Anfang–Mitte',
    'mid-late': 'Mitte–Ende',
    '1st-half': '1. Hälfte',
    '2nd-half': '2. Hälfte',
    full: '',
  }
  return labels[timing] ?? ''
}
const monthLabel = (month: string) =>
  MONTHS_DE[MONTHS_EN.indexOf(month as (typeof MONTHS_EN)[number])]

const formatPoint = (point: { month: string; timing?: string }) => {
  const m = monthLabel(point.month)
  const t = timingLabel(point.timing)
  return t ? `${t} ${m}` : m
}
---

<Layout canonicalUrl={canonicalUrl} title={veg.data.name}>
  <div class="mx-auto max-w-3xl px-4 py-8">
    <h1 class="mb-6 text-2xl font-bold">{veg.data.name}</h1>
    <h2 class="mb-3 text-lg font-semibold">Aussaatfenster</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Von</th>
          <th>Bis</th>
          <th>Folgesaat</th>
          <th>Hinweise</th>
        </tr>
      </thead>
      <tbody>
        {
          veg.data.sowingWindows.map((w) => (
            <tr>
              <td>{formatPoint(w.from)}</td>
              <td>{formatPoint(w.until)}</td>
              <td>
                {w.successionIntervalWeeks
                  ? `alle ${w.successionIntervalWeeks} Wochen`
                  : '–'}
              </td>
              <td class="flex flex-wrap gap-1">
                {(w.underCover ?? false) && (
                  <span class="badge badge-sm badge-info">geschützt</span>
                )}
                {(w.overwintering ?? false) && (
                  <span class="badge badge-sm badge-warning">Überwinterung</span>
                )}
                {w.note && (
                  <span class="badge badge-sm badge-ghost">{w.note}</span>
                )}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
    <div class="mt-6">
      <a href="../sowing-calendar" class="btn btn-outline btn-sm">
        ← Zurück zum Aussaatkalender
      </a>
    </div>
  </div>
</Layout>
