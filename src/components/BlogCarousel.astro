---
import { Image } from 'astro:assets'
import type { ImageMetadata } from 'astro'

interface Props {
  slides: { src: ImageMetadata; alt: string; caption?: string }[]
  id: string
  portrait?: boolean
}

const { slides, id, portrait = false } = Astro.props
---

<div class="carousel w-full">
  {
    slides.map((slide, i) => (
      <div
        id={`${id}-${i + 1}`}
        class:list={[
          'carousel-item relative w-full flex-col',
          { 'items-center': portrait },
        ]}
      >
        <Image
          src={slide.src}
          alt={slide.alt}
          widths={[480, 800, 1200]}
          sizes="(max-width: 75ch) 100vw, 75ch"
          quality={85}
          class:list={[
            'h-auto',
            portrait ? 'max-h-[70vh] w-auto mx-auto' : 'w-full',
          ]}
        />
        <div
          class:list={[
            'absolute flex -translate-y-1/2 justify-between',
            portrait
              ? 'left-0 right-0 top-1/2'
              : 'left-2 right-2 top-1/2',
          ]}
        >
          <a
            href={`#${id}-${i === 0 ? slides.length : i}`}
            class="btn btn-circle btn-sm opacity-70"
          >
            ❮
          </a>
          <a
            href={`#${id}-${i + 2 > slides.length ? 1 : i + 2}`}
            class="btn btn-circle btn-sm opacity-70"
          >
            ❯
          </a>
        </div>
        {slide.caption && (
          <p class="mt-2 text-center text-sm text-gray-500 dark:text-gray-400">
            {slide.caption} ({i + 1}/{slides.length})
          </p>
        )}
      </div>
    ))
  }
</div>
